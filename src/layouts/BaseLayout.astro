---
import '../styles/global.css';
const { title = "Regalo para mi amor 💖" } = Astro.props;
---

<html lang="es" data-base="${import.meta.env.BASE_URL}">
  <head>
    <meta charset="UTF-8" />
    <title>{title}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href={`${import.meta.env.BASE_URL}favicon.ico`} />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  </head>
  <body>
    <div class="petal-layer" aria-hidden="true"></div>

    <div class="layout-container">
      <header class="layout-header">
        <button id="modo-toggle">🌙 / ☀️</button>
      </header>

      <main>
        <slot />
      </main>

      <footer class="footer-banner">
        Hecho con mucho cariño para mi chica mexicana 🇲🇽🖤
      </footer>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const base = document.documentElement.getAttribute('data-base') || '/';

        // 🌙 Modo oscuro
        const toggle = document.getElementById('modo-toggle');
        const isDark = localStorage.getItem('modoOscuro') === 'true';
        if (isDark) document.body.classList.add('dark');

        toggle?.addEventListener('click', () => {
          document.body.classList.toggle('dark');
          localStorage.setItem('modoOscuro', document.body.classList.contains('dark'));
        });

        // 🌸 Pétalos flotantes
        const layer = document.querySelector('.petal-layer');
        layer.innerHTML = '';
        for (let i = 0; i < 20; i++) {
          const petal = document.createElement('div');
          petal.className = 'petal';
          const petalTypes = ['🌸', '🌺', '💮'];
          petal.textContent = petalTypes[Math.floor(Math.random() * petalTypes.length)];
          petal.style.left = `${Math.random() * 100}vw`;
          petal.style.animationDelay = `${Math.random() * 5}s`;
          layer.appendChild(petal);
        }

        // ✨ Transición entre vistas
        window.fadeAndGo = function (url) {
          const page = document.querySelector('.page-transition');
          if (page) {
            page.classList.add('fade-out');
            setTimeout(() => {
              window.location.assign(url);
            }, 600);
          } else {
            window.location.assign(url);
          }
        };

        // 🚪 Botón atrás inteligente
        window.goBack = (event) => {
          event?.preventDefault?.();
          if (document.referrer && document.referrer.includes(window.location.origin)) {
            history.back();
          } else {
            window.location.assign(base);
          }
        };

        // 🚀 Redirección limpia con base
        window.goTo = (ruta) => {
          const destino = base + ruta;
          fadeAndGo(destino);
        };
      });
    </script>
  </body>
</html>
