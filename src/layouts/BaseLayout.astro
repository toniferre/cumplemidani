---
// BaseLayout.astro
import '../styles/global.css';
const { title = "Regalo para mi amor üíñ" } = Astro.props;
---

<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>{title}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  </head>
  <body>
    <!-- üå∏ Capa de p√©talos en el fondo -->
    <div class="petal-layer" aria-hidden="true"></div>

    <div class="layout-container">
      <header class="layout-header">
        {Astro.url.pathname !== '/' && (
          <a href="javascript:history.back()" class="volver-btn">Atr√°s</a>
        )}
        <button id="modo-toggle">üåô / ‚òÄÔ∏è</button>
      </header>

      <main>
        <slot />
      </main>

      <footer class="footer-banner">
        Hecho con mucho cari√±o para mi chica mexicana üá≤üáΩüñ§
      </footer>
    </div>

    <script>
      window.addEventListener('load', () => {
        // üåô Modo claro/oscuro
        const toggle = document.getElementById('modo-toggle');
        toggle?.addEventListener('click', () => {
          document.body.classList.toggle('dark');
        });

        // üå∏ P√©talos flotando en el fondo
        const layer = document.querySelector('.petal-layer');
        for (let i = 0; i < 20; i++) {
          const petal = document.createElement('div');
          petal.className = 'petal';
          petal.textContent = 'üå∏';
          petal.style.left = `${Math.random() * 100}vw`;
          petal.style.animationDelay = `${Math.random() * 5}s`;
          layer.appendChild(petal);
        }

        // üéµ M√∫sica persistente
        const currentPath = window.location.pathname;
        const existingAudio = document.getElementById('bgMusic');

        if (currentPath === '/' || currentPath === '/secreto') {
          if (existingAudio) {
            let volume = existingAudio.volume;
            const fadeOut = setInterval(() => {
              if (volume > 0) {
                volume -= 0.05;
                existingAudio.volume = Math.max(volume, 0);
              } else {
                clearInterval(fadeOut);
                existingAudio.pause();
                existingAudio.remove();
                localStorage.removeItem('audioStarted');
              }
            }, 200);
          }
        } else {
          if (!existingAudio && !localStorage.getItem('audioStarted')) {
            const audio = document.createElement('audio');
            audio.id = 'bgMusic';
            audio.src = '/cancion.mp3';
            audio.loop = true;
            audio.autoplay = true;
            audio.volume = 0;
            audio.style.position = 'fixed';
            audio.style.bottom = '0';
            audio.style.left = '0';
            audio.style.opacity = '0';
            audio.style.pointerEvents = 'none';
            document.body.appendChild(audio);

            let volume = 0;
            const fadeIn = setInterval(() => {
              if (volume < 0.6) {
                volume += 0.05;
                audio.volume = Math.min(volume, 0.6);
              } else {
                clearInterval(fadeIn);
              }
            }, 200);

            localStorage.setItem('audioStarted', 'true');
          }
        }
      });
    </script>

    <style>
      .layout-container {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        position: relative;
        z-index: 1;
      }

      main {
        flex: 1;
      }

      .footer-banner {
        text-align: center;
        padding: 1rem;
        background-color: #fff0f5;
        font-size: 0.9rem;
      }

      body.dark {
        background-color: #000;
        background-image: url('/estrellas.gif');
        background-size: cover;
        background-repeat: repeat;
        background-attachment: fixed;
        color: #f0f0f0;
      }

      .petal-layer {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
        pointer-events: none;
        overflow: hidden;
      }

      .petal {
        position: absolute;
        top: -50px;
        font-size: 1.5rem;
        animation: fall 10s linear infinite;
      }

      @keyframes fall {
        to {
          transform: translateY(100vh) rotate(360deg);
        }
      }
    </style>
  </body>
</html>
