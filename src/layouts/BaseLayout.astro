---
// BaseLayout.astro
import '../styles/global.css';
const { title = "Regalo para mi amor ğŸ’–" } = Astro.props;
---

<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>{title}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  </head>
  <body>
    <div class="layout-container">
      <header class="layout-header">
        {Astro.url.pathname !== '/' && (
          <a href="javascript:history.back()" class="volver-btn">AtrÃ¡s</a>
        )}
        <button id="modo-toggle">ğŸŒ™ / â˜€ï¸</button>
      </header>

      <main>
        <slot />
      </main>

      <footer class="footer-banner">
        Hecho con mucho cariÃ±o para mi chica mexicana ğŸ‡²ğŸ‡½ğŸ–¤
      </footer>
    </div>

    <script src="https://unpkg.com/scrollreveal"></script>
    <script>
      window.addEventListener('load', () => {
        // ğŸŒ™ Modo claro/oscuro
        const toggle = document.getElementById('modo-toggle');
        toggle?.addEventListener('click', () => {
          document.body.classList.toggle('dark');
        });

        // âœ¨ Animaciones con ScrollReveal
        ScrollReveal().reveal('.reveal', {
          delay: 200,
          distance: '40px',
          origin: 'bottom',
          duration: 600,
          easing: 'ease-in-out',
          reset: false
        });

        // ğŸµ MÃºsica persistente con fade-in y fade-out
        const currentPath = window.location.pathname;
        const existingAudio = document.getElementById('bgMusic');

        if (currentPath === '/' || currentPath === '/secreto') {
          if (existingAudio) {
            let volume = existingAudio.volume;
            const fadeOut = setInterval(() => {
              if (volume > 0) {
                volume -= 0.05;
                existingAudio.volume = Math.max(volume, 0);
              } else {
                clearInterval(fadeOut);
                existingAudio.pause();
                existingAudio.remove();
                localStorage.removeItem('audioStarted');
              }
            }, 200);
          }
        } else {
          if (!existingAudio && !localStorage.getItem('audioStarted')) {
            const audio = document.createElement('audio');
            audio.id = 'bgMusic';
            audio.src = '/cancion.mp3';
            audio.loop = true;
            audio.autoplay = true;
            audio.volume = 0;
            audio.style.position = 'fixed';
            audio.style.bottom = '0';
            audio.style.left = '0';
            audio.style.opacity = '0';
            audio.style.pointerEvents = 'none';
            document.body.appendChild(audio);

            let volume = 0;
            const fadeIn = setInterval(() => {
              if (volume < 0.6) {
                volume += 0.05;
                audio.volume = Math.min(volume, 0.6);
              } else {
                clearInterval(fadeIn);
              }
            }, 200);

            localStorage.setItem('audioStarted', 'true');
          }
        }
      });
    </script>

    <style>
      .layout-container {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      main {
        flex: 1;
      }

      .footer-banner {
        text-align: center;
        padding: 1rem;
        background-color: #ee81a5;
        font-size: 0.9rem;
      }
    </style>
  </body>
</html>
