---
// SecretGift.astro
---

<section class="gift-section">
  <div class="gift-box" id="giftBox">
    üéÅ <span>Abrir</span>
  </div>

  <div class="secret-message" id="secretMessage">
    <h2 id="typedMessage"></h2>
    <p>Hay cosas que no caben en palabras, pero este regalo es solo una muestra de lo mucho que significas para m√≠.</p>
    <p>Gracias por ser t√∫. Por tu luz, tu ternura, tu alegr√≠a. Te quiero con todo mi coraz√≥n.</p>
    <p>Espero estar muchos cumplea√±os m√°s a tu lado. Contigo todo es mejor.</p>
    <h2>üñ§ Te amo üñ§</h2>
    <p>Posdata: no seas muy dura encontrando errores en la web ü§°</p>
    <img src="/hug.jpg" alt="Te amo" class="teamo-img" />
  </div>
</section>

<audio id="giftMusic" src="/cancion.mp3" preload="auto"></audio>

<script type="module">
  import confetti from 'https://cdn.skypack.dev/canvas-confetti';

  document.addEventListener('DOMContentLoaded', () => {
    const box = document.getElementById('giftBox');
    const message = document.getElementById('secretMessage');
    const music = document.getElementById('giftMusic');
    const typed = document.getElementById('typedMessage');

    box.addEventListener('click', () => {
      box.classList.add('opening');

      setTimeout(() => {
        box.style.display = 'none';
        message.classList.add('visible');

        // ‚úçÔ∏è Letras una a una
        revealText(typed, 'üíñ FELIZ CUMPLEA√ëOS üíñ', 60);

        // üéµ M√∫sica con fade-in
        music.volume = 0;
        music.play().catch(err => console.warn('No se pudo reproducir la m√∫sica:', err));
        let volume = 0;
        const fadeIn = setInterval(() => {
          if (volume < 0.6) {
            volume += 0.05;
            music.volume = Math.min(volume, 0.6);
          } else {
            clearInterval(fadeIn);
          }
        }, 200);

        // üéâ Confeti
        confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
      }, 1000);
    });

    function revealText(element, text, speed = 50) {
      let i = 0;
      element.textContent = '';
      const interval = setInterval(() => {
        element.textContent += text[i];
        i++;
        if (i >= text.length) clearInterval(interval);
      }, speed);
    }
  });
</script>

<style>
  .gift-section {
    text-align: center;
    padding: 3rem;
  }

  .gift-box {
    font-size: 3rem;
    cursor: pointer;
    display: inline-block;
    padding: 2rem;
    border: 2px solid #ff69b4;
    border-radius: 1rem;
    animation: vibrar 0.5s infinite;
    background-color: #fff0f5;
    transition: transform 0.3s ease;
  }

  .gift-box:hover {
    transform: scale(1.05);
  }

  .gift-box.opening {
    animation: abrirCaja 1s forwards;
  }

  @keyframes vibrar {
    0% { transform: rotate(0deg); }
    25% { transform: rotate(2deg); }
    50% { transform: rotate(-2deg); }
    75% { transform: rotate(2deg); }
    100% { transform: rotate(0deg); }
  }

  @keyframes abrirCaja {
    0% { transform: scale(1) rotate(0deg); opacity: 1; }
    50% { transform: scale(1.2) rotate(10deg); }
    100% { transform: scale(0) rotate(360deg); opacity: 0; }
  }

  .secret-message {
    margin-top: 2rem;
    opacity: 0;
    transform: scale(0.8);
    transition: opacity 1s ease, transform 0.5s ease;
  }

  .secret-message.visible {
    opacity: 1;
    transform: scale(1);
  }
</style>
